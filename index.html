<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test API</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
      }
      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
      }
      .container {
        display: flex;
        gap: 20px;
        max-width: 1400px;
        margin: 0 auto;
        width: 100%;
      }
      .column {
        flex: 1 1 0;
        min-width: 0;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        min-height: 400px;
      }
      .column h2 {
        color: #333;
        border-bottom: 2px solid #4caf50;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }
      .item {
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 20px;
        background-color: #fafafa;
      }
      .item h3 {
        color: #4caf50;
        margin-top: 0;
        margin-bottom: 10px;
      }
      .item p {
        color: #666;
        line-height: 1.6;
        margin: 8px 0;
      }
      .item .section {
        margin: 15px 0;
      }
      .item .section h4 {
        color: #333;
        margin-top: 0;
        margin-bottom: 8px;
      }
      .item .section-content {
        color: #555;
        margin: 5px 0;
      }
      .item a {
        color: #4caf50;
        text-decoration: none;
      }
      .item a:hover {
        text-decoration: underline;
      }
      .loading {
        text-align: left;
        color: #666;
        padding: 20px;
      }
      .error {
        color: red;
        padding: 10px;
        background-color: #ffe6e6;
        border-radius: 4px;
        margin: 10px 0;
      }
      .empty {
        text-align: center;
        color: #999;
        padding: 20px;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <h1>Test API - Newsletters & Factsheets</h1>
    <div class="container">
      <div class="column">
        <h2>Newsletters</h2>
        <div id="newsletters-result" class="loading">
          Loading newsletters...
        </div>
      </div>
      <div class="column">
        <h2>Factsheets</h2>
        <div id="factsheets-result" class="loading">Loading factsheets...</div>
      </div>
    </div>
    <script>
      const API_KEY =
        "49f47cb0e2fd17600a1cfa31b564cf2f8655b6c976410c7fb5cdfac258e0ac94";
      const API_BASE_URL =
        "https://content-api-2020-5886a3310333.herokuapp.com/api";

      // Get result elements from the DOM
      const newslettersResult = document.getElementById("newsletters-result");
      const factsheetsResult = document.getElementById("factsheets-result");

      // Function to format sections for display
      function formatSections(sections) {
        if (!sections || !Array.isArray(sections) || sections.length === 0) {
          return "<p class='empty'>No sections available</p>";
        }

        let sectionsHTML = "";
        sections.forEach((section) => {
          sectionsHTML += `
            <div class="section">
              <h4>${section.title || "Untitled Section"}</h4>
              ${
                section.content && Array.isArray(section.content)
                  ? section.content
                      .map(
                        (content) =>
                          `<div class="section-content">${content}</div>`
                      )
                      .join("")
                  : ""
              }
            </div>
          `;
        });
        return sectionsHTML;
      }

      // Function to render newsletters
      function renderNewsletters(newsletters) {
        if (!newsletters || newsletters.length === 0) {
          newslettersResult.innerHTML =
            '<p class="empty">No newsletters found</p>';
          return;
        }

        let html = "";
        newsletters.forEach((newsletter) => {
          const title = newsletter.title || "No title";
          const intro = newsletter.intro || "No introduction";
          const sections = newsletter.sections || [];
          const link = newsletter.link || "";
          const createdAt = newsletter.createdAt
            ? new Date(newsletter.createdAt).toLocaleDateString()
            : "";

          html += `
            <div class="item">
              <h3>${title}</h3>
              ${createdAt ? `<p><small>Created: ${createdAt}</small></p>` : ""}
               ${intro}</p>
              ${formatSections(sections)}
              ${
                link
                  ? `<p><a href="${link}" target="_blank">View Link: ${link}</a></p>`
                  : ""
              }
            </div>
          `;
        });

        newslettersResult.innerHTML = html;
      }

      // Function to render factsheets
      function renderFactsheets(factsheets) {
        if (!factsheets || factsheets.length === 0) {
          factsheetsResult.innerHTML =
            '<p class="empty">No factsheets found</p>';
          return;
        }

        let html = "";
        factsheets.forEach((factsheet) => {
          const title = factsheet.title || "No title";
          const intro = factsheet.intro || "No introduction";
          const sections = factsheet.sections || [];
          const link = factsheet.link || "";
          const createdAt = factsheet.createdAt
            ? new Date(factsheet.createdAt).toLocaleDateString()
            : "";

          html += `
            <div class="item">
              <h3>${title}</h3>
              ${createdAt ? `<p><small>Created: ${createdAt}</small></p>` : ""}
               ${intro}</p>
              ${formatSections(sections)}
              ${
                link
                  ? `<p><a href="${link}" target="_blank">View Link: ${link}</a></p>`
                  : ""
              }
            </div>
          `;
        });

        factsheetsResult.innerHTML = html;
      }

      // Fetch all newsletters
      fetch(`${API_BASE_URL}/newsletters`, {
        headers: {
          Authorization: `Bearer ${API_KEY}`,
          "Content-Type": "application/json",
        },
      })
        .then((response) => {
          if (!response.ok) {
            return response.json().then((errorData) => {
              throw new Error(
                errorData.message || `HTTP error! status: ${response.status}`
              );
            });
          }
          return response.json();
        })
        .then((data) => {
          console.log("Newsletters API Response:", data);

          if (!data || !data.data || !data.data.newsletters) {
            newslettersResult.innerHTML = `
              <div class="error">Error: Unexpected response structure</div>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            return;
          }

          const newsletters = data.data.newsletters;
          renderNewsletters(newsletters);
        })
        .catch((error) => {
          console.error("Error fetching newsletters:", error);
          newslettersResult.innerHTML = `<div class="error">Error: ${error.message}</div>`;
        });

      // Fetch all factsheets
      fetch(`${API_BASE_URL}/factsheets`, {
        headers: {
          Authorization: `Bearer ${API_KEY}`,
          "Content-Type": "application/json",
        },
      })
        .then((response) => {
          if (!response.ok) {
            return response.json().then((errorData) => {
              throw new Error(
                errorData.message || `HTTP error! status: ${response.status}`
              );
            });
          }
          return response.json();
        })
        .then((data) => {
          console.log("Factsheets API Response:", data);

          if (!data || !data.data || !data.data.factsheets) {
            factsheetsResult.innerHTML = `
              <div class="error">Error: Unexpected response structure</div>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            return;
          }

          const factsheets = data.data.factsheets;
          renderFactsheets(factsheets);
        })
        .catch((error) => {
          console.error("Error fetching factsheets:", error);
          factsheetsResult.innerHTML = `<div class="error">Error: ${error.message}</div>`;
        });
    </script>
  </body>
</html>
